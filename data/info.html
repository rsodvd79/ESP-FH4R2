<!doctype html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ESP32-S3 - Info FS</title>
    <style>
      html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
      .wrap { min-height: 100%; display: grid; place-items: center; background: #0f172a; color: #e2e8f0; }
      .card { padding: 2rem 2.5rem; border-radius: 12px; background: #111827; box-shadow: 0 10px 30px rgba(0,0,0,.35); width: min(720px, 94vw); }
      h1 { margin: 0 0 .25rem; font-size: 1.5rem; }
      .sub { color: #94a3b8; font-size: .95rem; }
      pre { background:#0b1220; color:#e2e8f0; border:1px solid #1f2937; border-radius:8px; padding: .75rem 1rem; overflow:auto; }
      .btns { display:flex; gap:.75rem; margin:.75rem 0 1rem; }
      button { padding:.5rem .85rem; border-radius:8px; border:1px solid #1f2937; background:#1f2937; color:#e5e7eb; cursor:pointer; }
      a { color:#60a5fa; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="card">
        <h1>Info Filesystem</h1>
        <p class="sub">Visualizza elenco file SPIFFS e informazioni di utilizzo.</p>

        <div class="btns">
          <button id="refresh">Aggiorna</button>
          <a href="/" style="margin-left:auto; align-self:center;">Torna alla Home</a>
        </div>

        <h3 style="margin:.5rem 0 .25rem;">fsinfo</h3>
        <pre id="fsinfo">Caricamento...</pre>

        <h3 style="margin:1rem 0 .25rem;">ls</h3>
        <pre id="ls">Caricamento...</pre>

        <p id="status" class="sub" style="margin-top:.75rem;">Pronto.</p>
      </div>
    </div>

    <script>
      const fsinfoEl = document.getElementById('fsinfo');
      const lsEl = document.getElementById('ls');
      const statusEl = document.getElementById('status');
      const refreshBtn = document.getElementById('refresh');

      async function loadFsInfo() {
        try {
          const res = await fetch('/fsinfo');
          if (!res.ok) throw new Error('HTTP ' + res.status);
          const txt = await res.text();
          fsinfoEl.textContent = txt.trim();
        } catch (e) {
          fsinfoEl.textContent = 'Errore: ' + e.message;
        }
      }

      async function loadLs() {
        try {
          const res = await fetch('/ls');
          if (!res.ok) throw new Error('HTTP ' + res.status);
          const txt = await res.text();
          lsEl.textContent = txt.trim();
        } catch (e) {
          lsEl.textContent = 'Errore: ' + e.message;
        }
      }

      async function refreshAll() {
        statusEl.textContent = 'Aggiornamento...';
        await Promise.all([loadFsInfo(), loadLs()]);
        statusEl.textContent = 'Aggiornato.';
      }

      refreshBtn.addEventListener('click', refreshAll);
      refreshAll();
    </script>
  </body>
  </html>

